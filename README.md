# mlx-monitoring

This is built on top of Marcin Zablocki's Mellanox Monitoring tool:
https://github.com/MarcinZablocki/mlx_monitor/

Usage:
```bash
python3 -m venv mlxmonitoring
source mlxmonitoring/bin/activate
pip3 install tabulate
pip3 install pynvml

## For RoCE/Eth (from ethtool statistics):
python3 monitorv2.py
=== NIC Stats (Gbps, Cumulative Drops) ===
NIC             RX History                        RX Gbps    RX Max  TX History                        TX Gbps    TX Max    RX Drop (total)    TX Drop (total)
--------------  ------------------------------  ---------  --------  ------------------------------  ---------  --------  -----------------  -----------------
mlx5_0 (rdma0)  ······························          0         0  ······························          0      0                     0                  0
mlx5_1 (rdma1)  ······························          0         0  ······························          0      0                     0                  0
mlx5_2 (rdma2)  ······························          0         0  ······························          0      0                     0                  0
mlx5_3 (rdma3)  ······························          0         0  ······························          0      0                     0                  0
mlx5_4 (eth0)   ····························█▄          0         0  ····························█·          0      0.03                  0                  0
mlx5_5 (rdma4)  ······························          0         0  ······························          0      0                     0                  0
mlx5_6 (rdma5)  ······························          0         0  ······························          0      0                     0                  0
mlx5_7 (rdma6)  ······························          0         0  ······························          0      0                     0                  0
mlx5_8 (rdma7)  ······························          0         0  ······························          0      0                     0                  0
mlx5_9 (eth1)   ······························          0         0  ······························          0      0                     0                  0

=== RDMA NIC traffic classes per-Priority Bandwidth (Gbps) ===
NIC                 RX P0    RX P1    RX P2    RX P3    RX P4    RX P5    RX P6    RX P7    TX P0    TX P1    TX P2    TX P3    TX P4    TX P5    TX P6    TX P7    TOTAL RX    TOTAL TX
----------------  -------  -------  -------  -------  -------  -------  -------  -------  -------  -------  -------  -------  -------  -------  -------  -------  ----------  ----------
mlx5_0:1 (rdma0)        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0           0           0
mlx5_1:1 (rdma1)        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0           0           0
mlx5_2:1 (rdma2)        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0           0           0
mlx5_3:1 (rdma3)        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0           0           0
mlx5_5:1 (rdma4)        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0           0           0
mlx5_6:1 (rdma5)        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0           0           0
mlx5_7:1 (rdma6)        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0           0           0
mlx5_8:1 (rdma7)        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0           0           0

=== GPU Stats ===
GPU    Util History                      Util %    Util Max  Mem History                       Mem %    Mem Max  Temp    Power         Graphics Freq    Memory Freq
-----  ------------------------------  --------  ----------  ------------------------------  -------  ---------  ------  ------------  ---------------  -------------
GPU-0  ······························         0           0  ···························███      0.6        0.6  35C     221W / 1200W  2062 MHz         3996 MHz
GPU-1  ······························         0           0  ···························███      0.6        0.6  34C     216W / 1200W  2062 MHz         3996 MHz
GPU-2  ······························         0           0  ···························███      0.6        0.6  34C     220W / 1200W  2062 MHz         3996 MHz
GPU-3  ······························         0           0  ···························███      0.6        0.6  34C     234W / 1200W  2062 MHz         3996 MHz

#For Infiniband (this takes stats from infiniband counters)
 python3 monitorv2.py --ib
=== InfiniBand Fabric Port Counters ===
IB Port      TX Packets    RX Packets    TX Gbps    RX Gbps    TX Max    RX Max    TX Discards    RX Errors    Symbol Errors    Link Downs    Link Recovery
---------  ------------  ------------  ---------  ---------  --------  --------  -------------  -----------  ---------------  ------------  ---------------
mlx5_0:1      168582123     175587390          0          0         0         0              0            0                0             0                0
mlx5_1:1      166966903     174036293          0          0         0         0              0            0                0             0                0
mlx5_2:1      169322332     176326737          0          0         0         0              0            0                0             0                0
mlx5_3:1      167881158     174975705          0          0         0         0              0            0                0             0                0
mlx5_4:1              0             0          0          0         0         0              0            0                0             0                0
mlx5_5:1      165107716     176438218          0          0         0         0              0            0                0             0                0
mlx5_6:1      163045512     174489900          0          0         0         0              0            0                0             0                0
mlx5_7:1      166793197     175779656          0          0         0         0              0            0                0             0                0
mlx5_8:1      164311011     173774495          0          0         0         0              0            0                0             0                0
mlx5_9:1              0             0          0          0         0         0              0            0                0             0                0

=== GPU Stats ===
GPU    Util History                      Util %    Util Max  Mem History                       Mem %    Mem Max  Temp    Power         Graphics Freq    Memory Freq
-----  ------------------------------  --------  ----------  ------------------------------  -------  ---------  ------  ------------  ---------------  -------------
GPU-0  ······························         0           0  ······························      0.6        0.6  35C     221W / 1200W  2062 MHz         3996 MHz
GPU-1  ······························         0           0  ······························      0.6        0.6  34C     216W / 1200W  2062 MHz         3996 MHz
GPU-2  ······························         0           0  ······························      0.6        0.6  34C     220W / 1200W  2062 MHz         3996 MHz
GPU-3  ······························         0           0  ······························      0.6        0.6  34C     234W / 1200W  2062 MHz         3996 MHz

#To dump stats to a csv file
python3 monitorv2.py --dump
##or
python3 monitorv2.py --ib --dump
